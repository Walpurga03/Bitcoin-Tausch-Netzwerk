<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Bitcoin Tausch Netzwerk</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="styles/main.css" rel="stylesheet">
</head>
<body class="glassmorphic-body">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-glass fixed-top">
        <div class="container">
            <a class="navbar-brand text-white fw-bold" href="#">
                <i class="bi bi-currency-bitcoin text-warning me-2"></i>
                Bitcoin Tausch
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link text-white me-3" href="my-offers.html">
                    <i class="bi bi-briefcase me-1"></i>Meine Angebote
                </a>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">
                    <i class="bi bi-box-arrow-right me-1"></i>Logout
                </button>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 100px;">
        <!-- Welcome Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glassmorphic-card text-center">
                    <h1 class="text-white mb-3">
                        <i class="bi bi-currency-bitcoin text-warning me-2"></i>
                        Bitcoin Tausch Dashboard
                    </h1>
                    <p class="text-white-50 mb-0">Willkommen im privaten Bitcoin-Handels-Netzwerk</p>
                    <small class="text-white-50">Angemeldet als: <span id="userInfo" class="text-warning"></span></small>
                </div>
            </div>
        </div>

        <!-- Simple Create Offer Button -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glassmorphic-card text-center">
                    <button class="btn btn-gradient btn-lg" onclick="openCreateOfferModal()">
                        <i class="bi bi-plus-circle me-1"></i>Angebot erstellen
                    </button>
                    <p class="text-white-50 mt-2 small">WÃ¤hle einen Angebots-Typ. Standard: "Rechnung Ã¼bernehmen" (150 â‚¬).</p>
                </div>
            </div>
        </div>

        <!-- Offers Grid -->
        <div class="row" id="offersContainer">
            <!-- Offers will be loaded here by JavaScript -->
        </div>
    </div>

    <!-- Interest Modal -->
    <div class="modal fade" id="interestModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-white">Interesse zeigen</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-white mb-3">Du zeigst Interesse an diesem Angebot:</p>
                    <div id="modalOfferDetails" class="text-white-50 mb-3"></div>
                    <div class="mb-3">
                        <label class="form-label text-white">Nachricht (optional):</label>
                        <textarea class="form-control bg-dark border-secondary text-white" id="interestMessage" rows="3" placeholder="Hallo, ich interessiere mich fÃ¼r dein Angebot..."></textarea>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="button" class="btn btn-gradient" onclick="sendInterest()">
                        <i class="bi bi-send me-1"></i>Interesse senden
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Offer Modal (simple) -->
    <div class="modal fade" id="createOfferModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-white">Ein neues Angebot erstellen</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label text-white">Angebotstyp</label>
                        <select id="offerType" class="form-select bg-dark text-white">
                            <option value="rechnung">Rechnung Ã¼bernehmen</option>
                            <option value="Ã¼berweisen">Ãœberweisen</option>
                            <option value="bar">Bar-Ãœbergabe</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-white">Betrag (â‚¬)</label>
                        <input type="number" id="offerAmount" class="form-select bg-dark text-white" 
                               placeholder="z.B. 150" min="1" max="10000" step="1" value="150">
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="button" class="btn btn-gradient" onclick="createOffer()">Angebot erstellen</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="config.js"></script>
    <script>
        // Demo offers data (now with different amounts as examples)
        const demoOffers = [
            {
                id: 1,
                type: 'rechnung',
                title: 'Rechnung Ã¼bernehmen',
                price: 'â‚¬250',
                description: 'Ãœbernehme deine Rechnung fÃ¼r 250 Euro. Einfach und schnell.',
                avatar: 'ðŸ§¾'
            },
            {
                id: 2,
                type: 'Ã¼berweisen',
                title: '100 Euro Ãœberweisung',
                price: 'â‚¬100',
                description: 'Ãœberweise dir 100 Euro per BankÃ¼berweisung.',
                avatar: 'ðŸ’³'
            },
            {
                id: 3,
                type: 'bar',
                title: '500 Euro Bar-Ãœbergabe',
                price: 'â‚¬500',
                description: 'Treffen fÃ¼r 500 Euro Bar-Ãœbergabe.',
                avatar: 'ðŸ’°'
            }
        ];

        function renderOffers() {
            const container = document.getElementById('offersContainer');
            
            container.innerHTML = demoOffers.map(offer => `
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="offer-card p-4">
                        <div class="text-center mb-4">
                            <div class="offer-icon mb-3">${offer.avatar}</div>
                            <h4 class="offer-title mb-2">${offer.title}</h4>
                            <div class="offer-price mb-3">${offer.price}</div>
                        </div>
                        
                        <button class="btn btn-gradient w-100 btn-lg" onclick="showInterest(${offer.id})">
                            <i class="bi bi-hand-thumbs-up me-1"></i>Interesse zeigen
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function showInterest(offerId) {
            const offer = demoOffers.find(o => o.id === offerId);
            if (offer) {
                document.getElementById('modalOfferDetails').innerHTML = `
                    <strong>${offer.title}</strong><br>
                    <small>Preis: ${offer.price}</small>
                `;
                const modal = new bootstrap.Modal(document.getElementById('interestModal'));
                modal.show();
                window.currentOfferId = offerId;
            }
        }

        function openCreateOfferModal() {
            const modal = new bootstrap.Modal(document.getElementById('createOfferModal'));
            document.getElementById('offerType').value = 'rechnung';
            modal.show();
        }

        function createOffer() {
            const type = document.getElementById('offerType').value;
            const amount = document.getElementById('offerAmount').value;
            
            if (!amount || amount <= 0) {
                alert('Bitte geben Sie einen gÃ¼ltigen Betrag ein.');
                return;
            }
            
            let title, avatar, description;
            
            switch(type) {
                case 'rechnung':
                    title = 'Rechnung Ã¼bernehmen';
                    avatar = 'ðŸ§¾';
                    description = `Ãœbernehme deine Rechnung fÃ¼r ${amount} Euro. Einfach und schnell.`;
                    break;
                case 'Ã¼berweisen':
                    title = `${amount} Euro Ãœberweisung`;
                    avatar = 'ðŸ’³';
                    description = `Ãœberweise dir ${amount} Euro per BankÃ¼berweisung.`;
                    break;
                case 'bar':
                    title = `${amount} Euro Bar-Ãœbergabe`;
                    avatar = 'ðŸ’°';
                    description = `Treffen fÃ¼r ${amount} Euro Bar-Ãœbergabe.`;
                    break;
            }

            const newOffer = {
                id: demoOffers.length ? Math.max(...demoOffers.map(o => o.id)) + 1 : 1,
                type: type,
                title: title,
                price: `â‚¬${amount}`,
                description: description,
                avatar: avatar
            };

            demoOffers.unshift(newOffer);
            renderOffers();
            const modal = bootstrap.Modal.getInstance(document.getElementById('createOfferModal'));
            modal.hide();
        }

        function sendInterest() {
            const message = document.getElementById('interestMessage').value;
            const offerId = window.currentOfferId;
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('interestModal'));
            modal.hide();
            
            // Show success message
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed';
            alertDiv.style = 'top: 120px; right: 20px; z-index: 9999;';
            alertDiv.innerHTML = `
                <i class="bi bi-check-circle me-2"></i>
                <strong>Interesse gesendet!</strong> Du wirst benachrichtigt, wenn der Anbieter antwortet.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = 'start.html';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const authorizedNpub = sessionStorage.getItem('authorized_npub');
            if (!authorizedNpub) {
                window.location.href = 'start.html';
                return;
            }

            // Show user info
            document.getElementById('userInfo').textContent = authorizedNpub.substring(0, 20) + '...';

            // Load offers
            renderOffers();
        });
    </script>
</body>
</html>
